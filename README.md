# Attiny13_Torch
LED flashlight control on Attiny13

Это старый проект найденный на сайте [mysku.club](https://mysku.club/blog/ebay/39366.html), с небольшими доработками.
1. Остались всё те-же режимы, минимальный, средний и максимальный. Но теперь ШИМ меняется в каждом режиме
в зависимости от напряжения на аккумуляторе.
2. Напряжение перехода в экономный режим и отключения понижены до минимальных, 3.1V и 2.8V соответвенно.
При разряде аккумулятора ниже 3.5V уже не имеет значения когда именно будет отсечка, светодиоды будут быстро терять яркость,
а режим минимального свечения будет настолько минимальным, что о нормальной работе речь не идёт. Это просто индикация разряда.
3. Сейчас все платы TP4056 идут с BMS, так что нет особого смысла в осечке именно логикой фонарика.
4. Убран переменный резистор, вместо него фиксированный делитель. Опять-же нет особого смысла ловить милливольты.
Но в случае исспользования "затылочного" светодиода, крутилка имеет смысл, так-как светодиод будет просаживать уровень
напряжения и вносить погрешность.
5. Сборка проекта проводится обычной средой Arduino с установленной microCore. Так проще.

## Варианты схем

[![Вариант с P-channel MOSFET](https://github.com/SerhiiLe/Attiny13_Torch/blob/main/P-channel.jpg)](https://github.com/SerhiiLe/Attiny13_Torch/blob/main/P-channel.jpg)
Транзистор к примеру такой: [P-Mosfet AO3401A](https://www.k206.net/catalog/159/10691/)

[![Вариант с N-channel MOSFET](https://github.com/SerhiiLe/Attiny13_Torch/blob/main/N-channel.jpg)](https://github.com/SerhiiLe/Attiny13_Torch/blob/main/N-channel.jpg)
Транзистор к примеру такой: [N-Mosfet AO3400A](https://www.k206.net/catalog/158/10744/)

Вариант с N-channel предпочтительнее.

Так-же, естественно, подходит оригинальная схема от автора.

## Сборка

Сборка в среде Arduino с устрановленной платформой MiroCore, для установки надо добавить в настройках такую ссылку:
https://mcudude.github.io/MicroCore/package_MCUdude_MicroCore_index.json

Для теста использовался бесплатный симулятор схем [SimulIDE](https://simulide.com/p/)
Файлы схем: attiny13_torch_p-ch.sim1 и attiny13_torch_n-ch.sim1 Правой клавишей по изображению контроллера позволяет подтянуть прошивку.

## Прошивка

Собственно после сборки в Arduino надо просто "загрузить на плату при помощи программатора". А вот что именно использовать 
в качестве программатора это уже Ваш выбор.

Можно прошивать готовые бинарные файлы любой программой для прошивки, их много. К примеру [Daduda](https://github.com/AndrejChoo/Cross-platform-avrdude-GUI)
или как у автора оригинального проекта.

Fuses: Low=7A , Hi=FF (AVRDUDE  -U lfuse:w:0x7A:m  -U hfuse:w:0xFF:m) (LOCKBIT=FF)
